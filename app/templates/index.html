<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Sentiment Analysis</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
    <header>
        <div class="intro">
            <h1>Twitter Sentiment Analysis</h1>
            <p>Positive press or needlessly negative? See how Twitter feels about this.</p>
        </div>
        <!-- Form to enter query term and tweet count -->
        <div class="right">
            <form method="POST">
                <label for="query">Enter a Keyword:</label>
                <input type="text" name="query" class="query" id="query" placeholder="Bitcoin" value="Bitcoin" required/>
                <label for="tweet-count">Number of Tweets to Display:</label>
                <input type="number" name="tweet-count" id="tweetCount" class="tweet-count" placeholder="100" value=100 required>
                <button type="submit" id="searchTweets">Search</button>
            </form>
            <div class="sentiment hidden" id="sentiment">
                <div class="loading hidden" id="loading">
                    <h1>Loading...</h1>
                </div>
                <div class="display hidden" id="display">
                <p class="title">Sentiment Analysis</p>
                <p id="positive">Positive: <span id="percent"></span>%</p>
                <p id="negative">Negative: <span id="percent"></span>%</p>
                <p id="neutral">Neutral: <span id="percent"></span>%</p>
            </div>
            </div>
        </div>
    </header>
    <section class="tweets" id="tweets">
        <div id="message" class="message" style="display: none;">
            <h1>Hello</h1>
        </div>
        <table id="displayResult" class="display">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tweets</th>
                    <th>Sentiment</th>
                </tr>
            </thead>
            <tbody>
                <!-- Adding dummy data to set table margins -->
                <tr>
                    <td>0</td>
                    <td>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nihil corporis pariatur harum consequuntur quo ab culpa quod, sapiente molestiae praesentium provident eaque labore facere doloribus blanditiis ipsam, quaerat animi sequi!</td>
                    <td>neutral</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nihil corporis pariatur harum consequuntur quo ab culpa quod, sapiente molestiae praesentium provident eaque labore facere doloribus blanditiis ipsam, quaerat animi sequi!</td>
                    <td>neutral</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nihil corporis pariatur harum consequuntur quo ab culpa quod, sapiente molestiae praesentium provident eaque labore facere doloribus blanditiis ipsam, quaerat animi sequi!</td>
                    <td>neutral</td>
                </tr>
            </tbody>
        </table>
    </section>
    <script>
        $(document).ready(function() {
            
            
            
            // DataTable to print Table in a better format
            var table = $('#displayResult').DataTable({
                retrieve: true,
                paging: true,
                searching: false,
            });
            // AJAX call to the backend to get classified tweets
            $("#searchTweets").click(function(e) {
                e.preventDefault();
                $("#message").show()
                $("#message h1").text("Loading...")
                $("#displayResult tbody").html('')
                $("#sentiment").removeClass("hidden")
                $("#sentiment #loading").removeClass("hidden")
                $("#sentiment #display").addClass("hidden")

                $.ajax({
                    //Send search term (query) and tweet count (tweetCount) to the backend
                    data: {
                        query: $("#query").val(),
                        tweetCount: $("#tweetCount").val(),
                    },
                    type: 'POST',
                    url: 'api/result',
                    // If post request is successful, then GET data from backend to display on frontend
                    success: (data) => {
                        //If data returned, hide loading/error message and print data
                        $("#message").hide()
                        console.log("Request successful")
                        console.log(data)
                        //Display sentiment percentages
                        $("#sentiment #loading").addClass("hidden")
                        $("#sentiment #display").removeClass("hidden")
                        $("#sentiment #positive #percent").text(data['percentages']['positive_percent'])
                        $("#sentiment #negative #percent").text(data['percentages']['negative_percent'])
                        $("#sentiment #neutral #percent").text(data['percentages']['neutral_percent'])

                        // Loop to print the result in a HTML table
                        for (var i = 0; i < $("#tweetCount").val(); i++) {
                            console.log(data['result']['Tweets'][i] + " " + data['result']['Sentiment'][i])
                            // Display current element as HTML row
                            var row = '<tr>' + '<td>' + (i+1) + '</td>' + '<td>' + data['result']['Tweets'][i] + '</td>' + '<td>' + data['result']['Sentiment'][i] + '</td>' + '</tr>'
                            // Append the row to table
                            $("#displayResult tbody").append(row)
                        }
                        
                    },
                    // If no data was returned from API
                    error: () => {
                        $("#message").show()
                        $("#message h1").text("There was an error :(")
                        console.log("ERROR")
                        console.log(data)
                    }
                })
            })
        })
    </script>
</body>
</html>